<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crispy Chicken — Compensation Tickets Dashboard</title>
  
  <!-- CSS Libraries -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Custom CSS -->
  <style>
    /* ===== ROOT VARIABLES ===== */
    :root {
      --crispy-red: #d32f2f;
      --crispy-dark: #b71c1c;
      --crispy-light: #ffebee;
      --crispy-accent: #ff7043;
      --bg: #fafafa;
      --muted: #6c757d;
      --card-bg: #ffffff;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-hover: 0 8px 15px rgba(0,0,0,0.2);
    }
    
    /* ===== BASE STYLES ===== */
    html, body {
      height: 100%;
      background: var(--bg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--text-primary);
      direction: ltr;
    }
    
    /* ===== NAVBAR ===== */
    .navbar {
      background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));
      box-shadow: 0 2px 10px rgba(0,0,0,.12);
      padding: 0.8rem 0;
    }
    
    .navbar .navbar-brand {
      color: #fff;
      font-weight: 700;
      font-size: 1.3rem;
    }
    
    /* ===== CONTAINER ===== */
    .container-page {
      max-width: 1400px;
      margin: 20px auto;
      padding: 0 20px;
    }
    
    /* ===== CARD STYLES ===== */
    .card-ghost {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .card-ghost:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }
    
    /* ===== STATS SECTION ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      padding: 24px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(211,47,47,0.05), rgba(211,47,47,0.1));
      border-left: 6px solid var(--crispy-red);
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }
    
    .stat-card h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 10px 0;
      color: var(--crispy-red);
    }
    
    .stat-card .text-muted {
      font-size: 0.95rem;
      font-weight: 500;
      letter-spacing: 0.5px;
    }
    
    /* ===== SUMMARY SECTION ===== */
    .summary-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .summary-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .summary-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .summary-card h6 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--crispy-dark);
    }
    
    .summary-metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .metric-item {
      text-align: center;
      padding: 16px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--crispy-red);
      margin-bottom: 4px;
    }
    
    .metric-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .metric-change {
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: 4px;
    }
    
    .metric-change.positive {
      color: #198754;
    }
    
    .metric-change.negative {
      color: #dc3545;
    }
    
    .metric-change.neutral {
      color: #6c757d;
    }
    
    .chart-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 20px;
    }
    
    .mini-chart {
      height: 150px;
    }
    
    /* ===== PLATFORM CARDS ===== */
    .platform-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 30px;
    }
    
    .platform-card {
      padding: 30px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(255,112,67,0.05), rgba(255,112,67,0.1));
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 1px solid rgba(255,112,67,0.1);
    }
    
    .platform-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }
    
    .platform-card h3 {
      font-size: 2.2rem;
      font-weight: 700;
      margin: 15px 0;
      color: var(--crispy-accent);
    }
    
    .platform-card .percentage {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--crispy-accent);
      margin-top: 8px;
    }
    
    /* ===== REPORTS SECTION ===== */
    #reports {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 30px;
    }
    
    .report-card {
      padding: 24px;
      border-radius: 16px;
      background: var(--card-bg);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .report-card h5 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    
    .report-card .chart-container {
      position: relative;
      height: 220px;
    }
    
    /* ===== CASE ANALYSIS ===== */
    .case-analysis-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .case-analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .case-analysis-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .case-badge {
      padding: 8px 16px;
      border-radius: 24px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .badge-high {
      background: var(--crispy-light);
      color: var(--crispy-red);
    }
    
    .badge-medium {
      background: #fff3e0;
      color: #ef6c00;
    }
    
    .badge-low {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .branch-analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 24px;
    }
    
    .branch-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .branch-card h6 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--crispy-dark);
    }
    
    .branch-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .branch-stat-item {
      text-align: center;
      padding: 12px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .branch-stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--crispy-red);
      margin-bottom: 4px;
    }
    
    .branch-stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .case-reasons {
      margin-top: 20px;
    }
    
    .case-reasons h6 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    
    .case-reason-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .case-reason-item:last-child {
      border-bottom: none;
    }
    
    .case-reason-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    
    .case-reason-name {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .case-reason-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    .case-reason-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      margin-top: 6px;
      overflow: hidden;
    }
    
    .case-reason-progress {
      height: 100%;
      background: var(--crispy-red);
      border-radius: 4px;
    }
    
    /* ===== COMPENSATION ANALYSIS ===== */
    .compensation-analysis-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .compensation-analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .compensation-analysis-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .compensation-analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .compensation-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .compensation-card h6 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--crispy-dark);
    }
    
    .compensation-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .stat-item {
      text-align: center;
      padding: 16px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--crispy-red);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    /* ===== REJECTION ANALYSIS ===== */
    .rejection-analysis-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .rejection-analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .rejection-analysis-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .rejection-analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .rejection-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .rejection-card h6 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--crispy-dark);
    }
    
    .rejection-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .rejection-metric-item {
      text-align: center;
      padding: 16px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .rejection-metric-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #dc3545;
      margin-bottom: 4px;
    }
    
    .rejection-metric-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    /* ===== REFUND ANALYSIS ===== */
    .refund-analysis-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .refund-analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .refund-analysis-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .refund-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .refund-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .refund-card h6 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--crispy-dark);
    }
    
    .refund-metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .refund-metric-item {
      text-align: center;
      padding: 16px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .refund-metric-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--crispy-red);
      margin-bottom: 4px;
    }
    
    .refund-metric-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .refund-chart-container {
      height: 200px;
      margin-top: 20px;
    }
    
    .refund-table-container {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .refund-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .refund-table th {
      background: #f1f3f5;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .refund-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    
    .refund-table tr:hover {
      background: #f8f9fa;
    }
    
    .refund-status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-refunded {
      background: #d4edda;
      color: #155724;
    }
    
    /* ===== TICKETS SECTION ===== */
    .tickets-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .tickets-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .tickets-header h5 {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }
    
    .tickets-header .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      flex: 1;
      margin-bottom: 16px;
    }
    
    .tickets-header .search-input {
      min-width: 200px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.1);
      padding: 8px 12px;
      font-size: 0.95rem;
    }
    
    .tickets-header .filter-select {
      min-width: 160px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.1);
      font-size: 0.95rem;
    }
    
    .tickets-header .action-buttons {
      display: flex;
      gap: 8px;
    }
    
    .tickets-header .btn {
      border-radius: 8px;
      font-weight: 600;
      padding: 8px 16px;
    }
    
    /* ===== TABLE STYLES ===== */
    .tickets-table-container {
      height: 600px;
      overflow-y: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      background: var(--card-bg);
      border: 1px solid rgba(0, 0, 0, 0.05);
      position: relative;
    }
    
    .tickets-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--card-bg);
      font-size: 0.95rem;
    }
    
    .tickets-table thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));
      color: white;
    }
    
    .tickets-table th {
      padding: 16px 12px;
      text-align: left;
      font-weight: 600;
      white-space: nowrap;
      position: relative;
    }
    
    .tickets-table th:not(:last-child)::after {
      content: '';
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 70%;
      width: 1px;
      background: rgba(255, 255, 255, 0.2);
    }
    
    .tickets-table td {
      padding: 16px 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      vertical-align: middle;
      white-space: nowrap;
    }
    
    .tickets-table tbody tr {
      transition: all 0.2s ease;
    }
    
    .tickets-table tbody tr:hover {
      background: rgba(0, 0, 0, 0.02);
      transform: scale(1.005);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    /* ===== CUSTOM SCROLLBAR ===== */
    .tickets-table-container::-webkit-scrollbar {
      width: 10px;
    }
    
    .tickets-table-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .tickets-table-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .tickets-table-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, var(--crispy-dark), var(--crispy-red));
      transform: scale(1.1);
    }
    
    /* ===== BACK TO TOP BUTTON ===== */
    .back-to-top {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));
      color: white;
      border: none;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .back-to-top:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      background: linear-gradient(135deg, var(--crispy-dark), var(--crispy-red));
    }
    
    .back-to-top.show {
      display: flex;
      animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ===== COLUMN SPECIFIC STYLES ===== */
    .ticket-order-id {
      font-weight: 700;
      color: var(--crispy-dark);
      font-size: 1rem;
    }
    
    .ticket-branch {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .ticket-platform {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .ticket-platform.noon {
      background: rgba(255, 112, 67, 0.1);
      color: var(--crispy-accent);
    }
    
    .ticket-platform.careem {
      background: rgba(126, 87, 194, 0.1);
      color: #7e57c2;
    }
    
    .ticket-issue {
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
      vertical-align: middle;
    }
    
    .issue-expand {
      background: none;
      border: none;
      color: #0d6efd;
      text-decoration: underline;
      font-size: 0.9rem;
      cursor: pointer;
      padding-left: 8px;
      transition: color 0.2s ease;
    }
    
    .issue-expand:hover {
      color: #0b5ed7;
    }
    
    .ticket-evidence {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .ticket-evidence-link {
      color: #0d6efd;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    
    .ticket-evidence-link:hover {
      color: #0b5ed7;
      text-decoration: underline;
    }
    
    .ticket-evidence-none {
      color: var(--text-secondary);
      font-style: italic;
    }
    
    /* ===== EVIDENCE THUMBNAIL STYLES ===== */
    .evidence-thumbnail {
      display: inline-block;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .evidence-thumbnail:hover {
      transform: scale(1.1);
    }
    
    .evidence-thumbnail img {
      border: 2px solid transparent;
      transition: border-color 0.2s;
      border-radius: 4px;
    }
    
    .evidence-thumbnail:hover img {
      border-color: var(--crispy-red);
    }
    
    .ticket-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .ticket-amount {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .ticket-amount.compensation {
      color: var(--crispy-red);
    }
    
    .ticket-amount.refunded {
      color: #28a745;
    }
    
    .ticket-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }
    
    .ticket-actions .btn {
      padding: 4px 6px;
      font-size: 0.75rem;
      border-radius: 4px;
      transition: all 0.2s ease;
      margin: 0;
    }
    
    .ticket-actions .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    /* ===== WHATSAPP BUTTON STYLE ===== */
    .btn-whatsapp {
      background-color: #25D366;
      border-color: #25D366;
      color: white;
    }
    
    .btn-whatsapp:hover {
      background-color: #128C7E;
      border-color: #128C7E;
      color: white;
    }
    
    /* ===== ROW HIGHLIGHTING ===== */
    .tickets-table tbody tr.high-compensation {
      background-color: rgba(255, 235, 238, 0.6) !important;
    }
    
    .tickets-table tbody tr.high-compensation:hover {
      background-color: rgba(255, 235, 238, 0.8) !important;
    }
    
    .tickets-table tbody tr.refunded-case {
      background-color: rgba(220, 242, 220, 0.6) !important;
    }
    
    .tickets-table tbody tr.refunded-case:hover {
      background-color: rgba(220, 242, 220, 0.8) !important;
    }
    
    .tickets-table tbody tr.rejected-case {
      background-color: rgba(255, 236, 236, 0.6) !important;
    }
    
    .tickets-table tbody tr.rejected-case:hover {
      background-color: rgba(255, 236, 236, 0.8) !important;
    }
    
    .tickets-table tbody tr.restaurant-fault {
      background-color: rgba(255, 248, 220, 0.6) !important;
    }
    
    .tickets-table tbody tr.restaurant-fault:hover {
      background-color: rgba(255, 248, 220, 0.8) !important;
    }
    
    /* ===== STATUS BADGE COLORS ===== */
    .status-open {
      background: rgba(13, 110, 253, 0.1);
      color: #0d6efd;
    }
    
    .status-sent {
      background: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }
    
    .status-closed {
      background: rgba(25, 135, 84, 0.1);
      color: #198754;
    }
    
    .status-rejected {
      background: rgba(220, 53, 69, 0.1);
      color: #dc3545;
    }
    
    /* ===== EMPTY STATE ===== */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
      background-color: rgba(0,0,0,0.02);
      border-radius: 12px;
      margin: 20px 0;
    }
    
    .empty-state i {
      font-size: 64px;
      color: #ddd;
      margin-bottom: 16px;
    }
    
    .empty-state h5 {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .empty-state p {
      margin-bottom: 24px;
    }
    
    /* ===== LOADING INDICATOR ===== */
    .table-loading {
      position: relative;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .table-loading::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(2px);
      z-index: 10;
    }
    
    .table-loading .loading-spinner {
      position: relative;
      z-index: 11;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(211, 47, 47, 0.1);
      border-top-color: var(--crispy-red);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== MODAL STYLES ===== */
    .modal-content {
      border-radius: 16px;
      border: none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    
    .modal-header {
      background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));
      color: #fff;
      border-radius: 16px 16px 0 0;
      padding: 20px 24px;
    }
    
    .modal-header .modal-title {
      font-weight: 700;
      font-size: 1.3rem;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .form-label {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .form-control, .form-select {
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.1);
      padding: 10px 14px;
      font-size: 0.95rem;
      transition: border-color 0.3s;
      margin-bottom: 16px;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--crispy-red);
      box-shadow: 0 0 0 0.2rem rgba(211,47,47,0.12);
    }
    
    .form-check-label {
      font-size: 0.9rem;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      background-color: #f8f9fa;
      border-top: 1px solid #eee;
    }
    
    .modal-footer .btn {
      border-radius: 8px;
      font-weight: 600;
      padding: 10px 20px;
    }
    
    /* ===== IMAGE UPLOAD STYLING ===== */
    .image-upload-container {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-bottom: 16px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .image-upload-container:hover {
      border-color: var(--crispy-red);
      background-color: rgba(211, 47, 47, 0.05);
    }
    
    .image-upload-container input[type="file"] {
      display: none;
    }
    
    .image-preview {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .short-link-container {
      margin-top: 16px;
    }
    
    .short-link-input {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ddd;
      padding: 8px 12px;
      font-size: 0.95rem;
    }
    
    .short-link-button {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--crispy-red);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    /* ===== DOCK STYLES ===== */
    #dock {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: flex-end;
    }
    
    .dock-toggle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .dock-toggle:hover {
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.5);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.2));
    }
    
    .dock-panel {
      display: none;
      flex-direction: column;
      gap: 16px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 24px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      border: 1px solid rgba(255, 255, 255, 0.18);
      width: 320px;
      max-height: 80vh;
      overflow-y: auto;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .dock-panel.show {
      display: flex;
      animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(30px) scale(0.95);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
    
    /* ===== DOCK SECTION STYLES ===== */
    .dock-section {
      margin-bottom: 8px;
    }
    
    .dock-section:last-child {
      margin-bottom: 0;
    }
    
    .dock-section-title {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 10px;
      padding-left: 8px;
      border-left: 3px solid rgba(255, 255, 255, 0.5);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .dock-section-title i {
      font-size: 0.9rem;
    }
    
    .dock-section-buttons {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    
    /* ===== COLOR-CODED BUTTONS BASED ON FUNCTION ===== */
    .dock-panel button {
      width: 100%;
      padding: 12px 16px;
      border-radius: 14px;
      font-size: 0.9rem;
      font-weight: 500;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: left;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .dock-panel button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    .dock-panel button:hover::before {
      transform: translateX(0);
    }
    
    .dock-panel button:hover {
      transform: translateX(-4px);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .dock-panel button i {
      font-size: 1.1rem;
      z-index: 1;
    }
    
    .dock-panel button span {
      z-index: 1;
    }
    
    /* ===== QUICK ACTIONS - BLUE THEME ===== */
    .dock-section.quick-actions button {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.3), rgba(33, 150, 243, 0.1));
    }
    
    .dock-section.quick-actions button:hover {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.4), rgba(33, 150, 243, 0.2));
    }
    
    /* ===== REPORTS - PURPLE THEME ===== */
    .dock-section.reports button {
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.3), rgba(156, 39, 176, 0.1));
    }
    
    .dock-section.reports button:hover {
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.4), rgba(156, 39, 176, 0.2));
    }
    
    /* ===== EXPORT - GREEN THEME ===== */
    .dock-section.export button {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1));
    }
    
    .dock-section.export button:hover {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(76, 175, 80, 0.2));
    }
    
    /* ===== MANAGEMENT - ORANGE THEME ===== */
    .dock-section.management button {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.3), rgba(255, 152, 0, 0.1));
    }
    
    .dock-section.management button:hover {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.4), rgba(255, 152, 0, 0.2));
    }
    
    /* ===== TOOLS - RED THEME ===== */
    .dock-section.tools button {
      background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.1));
    }
    
    .dock-section.tools button:hover {
      background: linear-gradient(135deg, rgba(244, 67, 54, 0.4), rgba(244, 67, 54, 0.2));
    }
    
    /* ===== NOTIFICATION BADGE ===== */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* ===== NOTIFICATIONS PANEL ===== */
    .notifications-panel {
      position: fixed;
      top: 80px;
      right: 24px;
      width: 400px;
      max-height: 70vh;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      z-index: 3000;
      display: none;
      overflow: hidden;
    }
    
    .notifications-panel.show {
      display: block;
      animation: slideIn 0.3s ease;
    }
    
    .notifications-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .notifications-header h5 {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 0;
    }
    
    .notifications-list {
      max-height: calc(70vh - 80px);
      overflow-y: auto;
    }
    
    .notification-item {
      padding: 16px 20px;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
    }
    
    .notification-item:hover {
      background-color: #f8f9fa;
    }
    
    .notification-item.unread {
      background-color: rgba(211, 47, 47, 0.05);
    }
    
    .notification-item:last-child {
      border-bottom: none;
    }
    
    .notification-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }
    
    .notification-message {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }
    
    .notification-time {
      font-size: 0.8rem;
      color: #999;
    }
    
    .notification-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    
    .notification-actions button {
      font-size: 0.8rem;
      padding: 4px 8px;
    }
    
    /* ===== DISPUTE REPORT STYLES ===== */
    .dispute-report-section, .periodic-summary {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 2px solid #d32f2f;
      padding-bottom: 10px;
    }
    
    .report-header h5 {
      color: #d32f2f;
      font-weight: bold;
    }
    
    .branch-report-card, .branch-summary-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #d32f2f;
    }
    
    .case-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    
    .case-item.pending {
      background: #fff3cd;
    }
    
    .case-item.recovered {
      background: #d4edda;
    }
    
    .case-info {
      display: flex;
      gap: 15px;
    }
    
    .case-order {
      font-weight: bold;
    }
    
    .case-platform {
      color: #6c757d;
    }
    
    .case-amount {
      color: #d32f2f;
      font-weight: bold;
    }
    
    .platform-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .platform-item {
      background: white;
      padding: 10px;
      border-radius: 5px;
    }
    
    .platform-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .platform-data {
      font-size: 0.9rem;
    }
    
    /* ===== UTILITY CLASSES ===== */
    .rounded-16 {
      border-radius: 16px !important;
    }
    
    .rounded-12 {
      border-radius: 12px !important;
    }
    
    .rounded-8 {
      border-radius: 8px !important;
    }
    
    /* ===== PRINT STYLES ===== */
    @media print{
      #dock, .tickets-header .btn, .action-buttons, .navbar, .modal, .notification, .commands-window, .storage-indicator { display:none !important; }
      body{background:#fff}
      .card-ghost{box-shadow:none;border:1px solid #ddd;}
    }
    
    /* ===== RESPONSIVE STYLES ===== */
    @media (max-width: 1200px){
      .container-page{max-width:100%;padding:0 16px;}
      .tickets-table-container {
        height: 500px;
      }
      .ticket-issue {
        max-width: 200px;
      }
    }
    @media (max-width: 992px){
      #reports{grid-template-columns:1fr;}
      .branch-analysis-grid{grid-template-columns:1fr;}
      .branch-stats{grid-template-columns:repeat(2,1fr);}
      .summary-grid{grid-template-columns:1fr;}
      .chart-row{grid-template-columns:1fr;}
      .refund-grid{grid-template-columns:1fr;}
      .compensation-analysis-grid{grid-template-columns:1fr;}
      .rejection-analysis-grid{grid-template-columns:1fr;}
      .all-commands-container { 
        margin-top: 160px;
        margin-right: 0;
      }
      .tickets-table-container {
        height: 400px;
      }
      .tickets-table th,
      .tickets-table td {
        padding: 12px 8px;
        font-size: 0.9rem;
      }
      .ticket-issue {
        max-width: 150px;
      }
      .ticket-actions {
        flex-direction: column;
        gap: 4px;
      }
    }
    @media (max-width: 768px){
      .stats-grid{grid-template-columns:1fr;}
      .platform-cards{grid-template-columns:1fr;}
      .tickets-header .filters{flex-direction:column;align-items:stretch;}
      .tickets-header .search-input,.tickets-header .filter-select{min-width:100%;}
      .tickets-header .action-buttons{justify-content:stretch;}
      .tickets-header .action-buttons .btn{flex:1;}
      .tickets-table{font-size:0.85rem;}
      .ticket-actions{justify-content:center;}
      #dock{right:16px;bottom:16px;}
      .dock-panel{width:180px;}
      .dock-panel button{min-width:160px;font-size:0.9rem;}
      .commands-window {
        width: 280px;
        right: 16px;
        bottom: 16px;
      }
      .all-commands-container { 
        margin-top: 140px;
        margin-right: 0;
      }
      .tickets-table-container {
        height: 350px;
      }
      .tickets-table th,
      .tickets-table td {
        padding: 10px 6px;
      }
      .ticket-issue {
        max-width: 120px;
      }
      .ticket-actions .btn {
        font-size: 0.75rem;
        padding: 4px 6px;
      }
    }
    @media (max-width: 576px){
      .container-page{padding:0 12px;}
      .card-ghost{padding:16px;}
      .stat-card h2{font-size:2rem;}
      .platform-card h3{font-size:1.8rem;}
      .report-card{padding:16px;}
      .tickets-table th,.tickets-table td{padding:8px 4px;}
      .ticket-issue{max-width:80px;}
      .all-commands-container { 
        margin-top: 120px;
        margin-right: 0;
      }
      .tickets-table-container {
        height: 300px;
      }
      .tickets-table {
        font-size: 0.8rem;
      }
      .ticket-actions {
        gap: 2px;
      }
      .ticket-actions .btn {
        padding: 3px 5px;
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <!-- ===== STORAGE INDICATOR ===== -->
  <div id="storageIndicator" class="storage-indicator">0% storage used</div>
  
  <!-- ===== NAVIGATION ===== -->
  <nav class="navbar navbar-expand-lg">
    <div class="container container-page">
      <a class="navbar-brand" href="#"><i class="bi bi-fire-fill me-2" style="font-size:1.6rem"></i> Crispy Chicken — Compensation Tickets</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link text-white fw-semibold" href="#">Dashboard</a></li>
          <li class="nav-item position-relative">
            <a class="nav-link text-white position-relative" href="#" onclick="showNotifications()">
              <i class="bi bi-bell"></i>
              <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <!-- ===== MAIN CONTENT ===== -->
  <main class="container-page">
    <!-- ===== STATS SECTION ===== -->
    <section class="stats-grid">
      <div class="stat-card text-center">
        <div class="text-muted">Total Cases</div>
        <h2 id="totalTickets">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#0d6efd;">
        <div class="text-muted">Open</div>
        <h2 id="openTickets" style="color:#0d6efd;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#ffc107;">
        <div class="text-muted">Sent</div>
        <h2 id="sentTickets" style="color:#ffc107;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#198754;">
        <div class="text-muted">Closed</div>
        <h2 id="closedTickets" style="color:#198754;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#28a745;">
        <div class="text-muted">Resolved Disputes</div>
        <h2 id="resolvedDisputes" style="color:#28a745;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#17a2b8;">
        <div class="text-muted">Active Compensations</div>
        <h2 id="activeCompensations" style="color:#17a2b8;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#dc3545;">
        <div class="text-muted">Total Compensation</div>
        <h2 id="totalCompensationAmount" style="color:#dc3545;">0</h2>
      </div>
      <div class="stat-card text-center" style="border-left-color:#dc3545;">
        <div class="text-muted">Rejected</div>
        <h2 id="rejectedTickets" style="color:#dc3545;">0</h2>
      </div>
    </section>
    
    <!-- ===== SUMMARY SECTION ===== -->
    <section class="summary-section">
      <div class="summary-header">
        <h5>Dashboard Summary</h5>
        <div class="text-muted">
          <i class="bi bi-calendar3 me-1"></i>
          <span id="summaryDate"></span>
        </div>
      </div>
      <div class="summary-grid">
        <div class="summary-card">
          <h6>Financial Overview</h6>
          <div class="summary-metrics">
            <div class="metric-item">
              <div class="metric-value" id="totalOriginalAmount">0</div>
              <div class="metric-label">Total Original Amount</div>
              <div class="metric-change" id="originalAmountChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="totalCompensation">0</div>
              <div class="metric-label">Total Compensation</div>
              <div class="metric-change" id="compensationChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="totalRefunded">0</div>
              <div class="metric-label">Total Refunded</div>
              <div class="metric-change" id="refundedChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="netCompensation">0</div>
              <div class="metric-label">Net Compensation</div>
              <div class="metric-change" id="netCompensationChange">+0%</div>
            </div>
          </div>
          <div class="chart-row">
            <div class="mini-chart">
              <canvas id="amountChart"></canvas>
            </div>
            <div class="mini-chart">
              <canvas id="statusChart"></canvas>
            </div>
          </div>
        </div>
        
        <div class="summary-card">
          <h6>Platform Performance</h6>
          <div class="summary-metrics">
            <div class="metric-item">
              <div class="metric-value" id="noonTickets">0</div>
              <div class="metric-label">Noon Cases</div>
              <div class="metric-change" id="noonTicketsChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="careemTickets">0</div>
              <div class="metric-label">Careem Cases</div>
              <div class="metric-change" id="careemTicketsChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="noonRefunded">0</div>
              <div class="metric-label">Noon Refunded</div>
              <div class="metric-change" id="noonRefundedChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="careemRefunded">0</div>
              <div class="metric-label">Careem Refunded</div>
              <div class="metric-change" id="careemRefundedChange">+0%</div>
            </div>
          </div>
          <div class="chart-row">
            <div class="mini-chart">
              <canvas id="platformTicketsChart"></canvas>
            </div>
            <div class="mini-chart">
              <canvas id="platformCompensationChart"></canvas>
            </div>
          </div>
        </div>
        
        <div class="summary-card">
          <h6>Branch Performance</h6>
          <div class="summary-metrics">
            <div class="metric-item">
              <div class="metric-value" id="topBranch">-</div>
              <div class="metric-label">Top Branch</div>
              <div class="metric-change" id="topBranchCases">0 cases</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="topCase">-</div>
              <div class="metric-label">Top Case</div>
              <div class="metric-change" id="topCaseCount">0 cases</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="caseRate">0%</div>
              <div class="metric-label">Case Rate</div>
              <div class="metric-change" id="caseRateChange">+0%</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="avgOriginalAmount">0</div>
              <div class="metric-label">Avg. Original Amount</div>
              <div class="metric-change" id="avgOriginalAmountChange">+0%</div>
            </div>
          </div>
          <div class="chart-row">
            <div class="mini-chart">
              <canvas id="branchCasesChart"></canvas>
            </div>
            <div class="mini-chart">
              <canvas id="caseTypesChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- ===== PLATFORM CARDS ===== -->
    <section class="platform-cards">
      <div class="platform-card">
        <div class="text-muted">Noon Cases</div>
        <h3 id="noonCount">0</h3>
        <div class="percentage" id="noonPercentage">0%</div>
      </div>
      <div class="platform-card">
        <div class="text-muted">Careem Cases</div>
        <h3 id="careemCount">0</h3>
        <div class="percentage" id="careemPercentage">0%</div>
      </div>
    </section>
    
    <!-- ===== REPORTS SECTION ===== -->
    <section id="reports">
      <div class="report-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5>Top Branches by Cases</h5>
          <small class="text-muted" id="topBranchLabel"></small>
        </div>
        <div class="chart-container">
          <canvas id="branchChart"></canvas>
        </div>
      </div>
      <div class="report-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5>Case Types Breakdown</h5>
          <small class="text-muted" id="topCaseLabel"></small>
        </div>
        <div class="chart-container">
          <canvas id="caseChart"></canvas>
        </div>
      </div>
    </section>
    
    <!-- ===== CASE ANALYSIS SECTION ===== -->
    <section class="case-analysis-section">
      <div class="case-analysis-header">
        <h5>Case Analysis Causing Compensation</h5>
        <div id="caseAnalysisBadge" class="case-badge badge-high">High Level</div>
      </div>
      <div id="branchAnalysisContainer"></div>
    </section>
    
    <!-- ===== COMPENSATION ANALYSIS SECTION ===== -->
    <section class="compensation-analysis-section">
      <div class="compensation-analysis-header">
        <h5>Compensation Analysis by Type</h5>
        <div class="text-muted">
          <i class="bi bi-bar-chart me-1"></i>
          Breakdown of compensation cases
        </div>
      </div>
      <div id="compensationAnalysisContainer"></div>
    </section>
    
    <!-- ===== REJECTION ANALYSIS SECTION ===== -->
    <section class="rejection-analysis-section">
      <div class="rejection-analysis-header">
        <h5>Rejection Analysis</h5>
        <div class="text-muted">
          <i class="bi bi-x-circle me-1"></i>
          Analysis of rejected compensation cases
        </div>
      </div>
      <div id="rejectionAnalysisContainer"></div>
    </section>
    
    <!-- ===== REFUND ANALYSIS SECTION ===== -->
    <section class="refund-analysis-section">
      <div class="refund-analysis-header">
        <h5>Refund Analysis</h5>
        <div class="text-muted">
          <i class="bi bi-arrow-repeat me-1"></i>
          Refunded Compensation Tracking
        </div>
      </div>
      <div class="refund-grid">
        <div class="refund-card">
          <h6>Overall Refunds</h6>
          <div class="refund-metrics">
            <div class="refund-metric-item">
              <div class="refund-metric-value" id="totalRefundedAmount">0</div>
              <div class="refund-metric-label">Total Refunded Amount</div>
            </div>
            <div class="refund-metric-item">
              <div class="refund-metric-value" id="refundedCasesCount">0</div>
              <div class="refund-metric-label">Refunded Cases</div>
            </div>
            <div class="refund-metric-item">
              <div class="refund-metric-value" id="refundRate">0%</div>
              <div class="refund-metric-label">Refund Rate</div>
            </div>
            <div class="refund-metric-item">
              <div class="refund-metric-value" id="avgRefundedAmount">0</div>
              <div class="refund-metric-label">Avg. Refunded Amount</div>
            </div>
          </div>
        </div>
        
        <div class="refund-card">
          <h6>Refunds by Branch</h6>
          <div class="refund-chart-container">
            <canvas id="refundBranchChart"></canvas>
          </div>
        </div>
      </div>
      
      <div class="refund-table-container">
        <table class="refund-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Branch</th>
              <th>Original Amount</th>
              <th>Compensation</th>
              <th>Refunded Amount</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="refundTableBody">
          </tbody>
        </table>
      </div>
    </section>
    
    <!-- ===== TICKETS SECTION ===== -->
    <section class="tickets-section">
      <div class="tickets-header">
        <h5>Compensation Cases</h5>
        <div class="filters">
          <input id="searchInput" class="form-control search-input" placeholder="Search case / branch / issue" />
          <select id="filterBranch" class="form-select filter-select">
            <option value="">All Branches</option>
          </select>
          <select id="filterPlatform" class="form-select filter-select">
            <option value="">All Platforms</option>
            <option>Noon</option>
            <option>Careem</option>
          </select>
          <select id="filterStatus" class="form-select filter-select">
            <option value="">All Status</option>
            <option>Open</option>
            <option>Sent</option>
            <option>Closed</option>
            <option>Rejected</option>
          </select>
          <div class="sort-controls">
            <label class="form-label me-2">Sort by:</label>
            <select id="sortCriteria" class="form-select" onchange="sortTickets(this.value)">
              <option value="date-desc">Date (Newest)</option>
              <option value="date-asc">Date (Oldest)</option>
              <option value="amount-desc">Amount (High to Low)</option>
              <option value="amount-asc">Amount (Low to High)</option>
              <option value="status">Status</option>
              <option value="platform">Platform</option>
            </select>
          </div>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="openAddModal()">
              <i class="bi bi-plus-circle me-1"></i> Add
            </button>
            <button class="btn btn-outline-secondary" onclick="addSample()">
              <i class="bi bi-flask me-1"></i> Sample
            </button>
            <button class="btn btn-success" onclick="document.getElementById('excelUploadInput').click()">
              <i class="bi bi-file-earmark-spreadsheet me-1"></i> Upload Excel/CSV
            </button>
          </div>
        </div>
      </div>
      <div id="ticketsContainer"></div>
    </section>
  </main>
  
  <!-- ===== NOTIFICATIONS PANEL ===== -->
  <div id="notificationsPanel" class="notifications-panel">
    <div class="notifications-header">
      <h5>Notifications</h5>
      <button class="btn btn-sm btn-outline-light" onclick="markAllAsRead()">Mark all as read</button>
    </div>
    <div id="notificationsList" class="notifications-list">
      <!-- Notifications will be populated here -->
    </div>
  </div>
  
  <!-- ===== DOCK PANEL ===== -->
  <div id="dock">
    <div id="dockPanel" class="dock-panel">
      <div class="dock-section quick-actions">
        <div class="dock-section-title">
          <i class="bi bi-lightning-charge"></i> Quick Actions
        </div>
        <div class="dock-section-buttons">
          <button onclick="openAddModal()">
            <i class="bi bi-plus-circle"></i>
            <span>Add New Case</span>
          </button>
          <button onclick="refreshData()">
            <i class="bi bi-arrow-clockwise"></i>
            <span>Refresh Data</span>
          </button>
          <button onclick="generateDailyReport()">
            <i class="bi bi-file-earmark-text"></i>
            <span>Daily Report</span>
          </button>
        </div>
      </div>
      
      <div class="dock-section reports">
        <div class="dock-section-title">
          <i class="bi bi-bar-chart"></i> Reports
        </div>
        <div class="dock-section-buttons">
          <div class="dock-dropdown">
            <button onclick="toggleDockDropdown(this)">
              <i class="bi bi-file-earmark-spreadsheet"></i>
              <span>Export Reports</span>
              <i class="bi bi-chevron-up ms-auto"></i>
            </button>
            <div class="dock-dropdown-menu">
              <a href="#" class="dock-dropdown-item" onclick="exportToExcel()">
                <i class="bi bi-file-earmark-excel"></i> Export to Excel
              </a>
              <a href="#" class="dock-dropdown-item" onclick="exportToPDF()">
                <i class="bi bi-file-earmark-pdf"></i> Export to PDF
              </a>
              <a href="#" class="dock-dropdown-item" onclick="exportToCSV()">
                <i class="bi bi-filetype-csv"></i> Export to CSV
              </a>
            </div>
          </div>
          <button onclick="generateDisputeReport()">
            <i class="bi bi-exclamation-triangle"></i>
            <span>Dispute Report</span>
          </button>
          <button onclick="generateFinancialReport()">
            <i class="bi bi-currency-dollar"></i>
            <span>Financial Report</span>
          </button>
        </div>
      </div>
      
      <div class="dock-section export">
        <div class="dock-section-title">
          <i class="bi bi-cloud-arrow-up"></i> Data Management
        </div>
        <div class="dock-section-buttons">
          <button onclick="document.getElementById('excelUploadInput').click()">
            <i class="bi bi-file-earmark-spreadsheet"></i>
            <span>Import Data</span>
          </button>
          <button onclick="openAPISettingsModal()">
            <i class="bi bi-cloud-download"></i>
            <span>Pick Up Data</span>
          </button>
          <button onclick="backupData()">
            <i class="bi bi-cloud-arrow-up"></i>
            <span>Backup Data</span>
          </button>
          <button onclick="restoreData()">
            <i class="bi bi-cloud-arrow-down"></i>
            <span>Restore Data</span>
          </button>
        </div>
      </div>
      
      <div class="dock-section management">
        <div class="dock-section-title">
          <i class="bi bi-gear"></i> Management
        </div>
        <div class="dock-section-buttons">
          <button onclick="openSettingsModal()">
            <i class="bi bi-gear"></i>
            <span>Settings</span>
          </button>
          <button onclick="openBranchManagement()">
            <i class="bi bi-shop"></i>
            <span>Branch Management</span>
          </button>
          <button onclick="openUserManagement()">
            <i class="bi bi-people"></i>
            <span>User Management</span>
          </button>
        </div>
      </div>
      
      <div class="dock-section tools">
        <div class="dock-section-title">
          <i class="bi bi-tools"></i> Tools
        </div>
        <div class="dock-section-buttons">
          <button onclick="clearAllData()">
            <i class="bi bi-trash3"></i>
            <span>Clear All Data</span>
          </button>
          <button onclick="archiveOldCases()">
            <i class="bi bi-archive"></i>
            <span>Archive Old Cases</span>
          </button>
          <button onclick="checkForDuplicates()">
            <i class="bi bi-clipboard-check"></i>
            <span>Check Duplicates</span>
          </button>
          <button onclick="setupSampleAPI()">
            <i class="bi bi-tools"></i>
            <span>Setup Sample API</span>
          </button>
        </div>
      </div>
    </div>
    
    <div id="dockToggle" class="dock-toggle" onclick="toggleDock()">
      <i class="bi bi-command"></i>
    </div>
  </div>
  
  <!-- ===== BACK TO TOP BUTTON ===== -->
  <button id="backToTop" class="back-to-top" onclick="scrollToTop()">
    <i class="bi bi-arrow-up"></i>
  </button>
  
  <!-- ===== ADD/EDIT TICKET MODAL ===== -->
  <div class="modal fade" id="ticketModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ticketModalTitle">Add New Compensation Case</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="ticketForm">
            <input type="hidden" id="ticketId">
            
            <!-- Section: Basic Information -->
            <fieldset class="mb-4">
              <legend><i class="bi bi-info-circle me-2"></i> Basic Information</legend>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="orderId" class="form-label">Order ID <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="orderId" required>
                  <div class="duplicate-warning text-danger mt-1" id="duplicateWarning">
                    <i class="bi bi-exclamation-triangle"></i> Duplicate Order ID detected
                  </div>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="orderDate" class="form-label">Order Date & Time <span class="text-danger">*</span></label>
                  <input type="datetime-local" class="form-control" id="orderDate" required>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="branch" class="form-label">Branch <span class="text-danger">*</span></label>
                  <select class="form-select" id="branch" required>
                    <option value="">Select Branch</option>
                    <!-- Options will be populated from JavaScript -->
                  </select>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="platform" class="form-label">Platform <span class="text-danger">*</span></label>
                  <select class="form-select" id="platform" required>
                    <option value="">Select Platform</option>
                    <option value="Noon">Noon</option>
                    <option value="Careem">Careem</option>
                  </select>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="status" class="form-label">Status <span class="text-danger">*</span></label>
                  <select class="form-select" id="status" required>
                    <option value="Open">Open</option>
                    <option value="Sent">Sent</option>
                    <option value="Closed">Closed</option>
                    <option value="Rejected">Rejected</option>
                  </select>
                </div>
                
                <div class="col-md-6 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="sendNotification">
                    <label class="form-check-label" for="sendNotification">
                      Send WhatsApp notification to branch
                    </label>
                  </div>
                </div>
              </div>
            </fieldset>
            
            <!-- Section: Financial Information -->
            <fieldset class="mb-4">
              <legend><i class="bi bi-currency-exchange me-2"></i> Financial Information</legend>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="originalAmount" class="form-label">Original Amount (AED) <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" id="originalAmount" step="0.01" required>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="compensationAmount" class="form-label">Compensation Amount (AED) <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" id="compensationAmount" step="0.01" required>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="refundMethod" class="form-label">Refund Method</label>
                  <select class="form-select" id="refundMethod">
                    <option value="">Not Refunded</option>
                    <option value="Careem Pay">Careem Pay</option>
                    <option value="Card">Card</option>
                    <option value="Cash">Cash</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                  </select>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="refundedAmount" class="form-label">Refunded Amount (AED)</label>
                  <input type="number" class="form-control" id="refundedAmount" step="0.01">
                </div>
              </div>
            </fieldset>
            
            <!-- Section: Case Details -->
            <fieldset class="mb-4">
              <legend><i class="bi bi-chat-dots me-2"></i> Case Details</legend>
              
              <div class="mb-3">
                <label for="issue" class="form-label">Case Description <span class="text-danger">*</span></label>
                <textarea class="form-control" id="issue" rows="3" required></textarea>
              </div>
              
              <div class="mb-3">
                <label for="notes" class="form-label">Additional Notes</label>
                <textarea class="form-control" id="notes" rows="2"></textarea>
              </div>
            </fieldset>
            
            <!-- Section: Evidence -->
            <fieldset class="mb-4">
              <legend><i class="bi bi-image me-2"></i> Evidence</legend>
              
              <div class="image-upload-container">
                <input type="file" id="evidence" accept="image/*" onchange="handleImageUpload(this)">
                <div id="imagePreviewContainer">
                  <p>Click or drag image here to upload</p>
                  <img id="imagePreview" class="image-preview" style="display: none;">
                  <div class="progress mt-2" id="uploadProgress" style="display: none;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                  </div>
                  <button type="button" class="btn btn-sm btn-danger mt-2" 
                          id="removeImageBtn" onclick="removeImage()" style="display: none;">
                    <i class="bi bi-trash"></i> Remove Image
                  </button>
                </div>
              </div>
              
              <div class="short-link-container mt-3">
                <label for="evidenceLink" class="form-label">Or provide evidence link</label>
                <div class="input-group">
                  <input type="url" class="form-control short-link-input" id="evidenceLink" 
                         placeholder="https://example.com/evidence.jpg">
                  <button class="btn btn-outline-secondary" type="button" onclick="shortenLink()">
                    <i class="bi bi-link-45deg"></i> Shorten
                  </button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveTicket()">Save Case</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== SETTINGS MODAL ===== -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Dashboard Settings</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="settingsForm">
            <div class="mb-3">
              <label for="theme" class="form-label">Theme</label>
              <select class="form-select" id="theme">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="auto">Auto (System)</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="itemsPerPage" class="form-label">Items Per Page</label>
              <select class="form-select" id="itemsPerPage">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="autoRefresh" class="form-label">Auto Refresh (minutes)</label>
              <select class="form-select" id="autoRefresh">
                <option value="0">Disabled</option>
                <option value="1">1</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="30">30</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="backupFrequency" class="form-label">Backup Frequency</label>
              <select class="form-select" id="backupFrequency">
                <option value="0">Disabled</option>
                <option value="1">Daily</option>
                <option value="7">Weekly</option>
                <option value="30">Monthly</option>
              </select>
            </div>
            
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="notifications">
              <label class="form-check-label" for="notifications">
                Enable Notifications
              </label>
            </div>
            
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="confirmActions">
              <label class="form-check-label" for="confirmActions">
                Confirm Before Deleting
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== BRANCH MANAGEMENT MODAL ===== -->
  <div class="modal fade" id="branchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Branch Management</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>Branch Statistics</h6>
              <div class="row">
                <div class="col-6">
                  <div class="text-center p-3 bg-light rounded">
                    <div class="h4 mb-0" id="totalBranchesCount">0</div>
                    <small class="text-muted">Total Branches</small>
                  </div>
                </div>
                <div class="col-6">
                  <div class="text-center p-3 bg-light rounded">
                    <div class="h4 mb-0" id="totalCasesCount">0</div>
                    <small class="text-muted">Total Cases</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h6>Quick Actions</h6>
              <div class="d-grid gap-2">
                <button class="btn btn-primary" onclick="showAddBranchForm()">
                  <i class="bi bi-plus-circle me-1"></i> Add New Branch
                </button>
                <button class="btn btn-outline-success" onclick="exportBranches()">
                  <i class="bi bi-download me-1"></i> Export Branches
                </button>
                <button class="btn btn-outline-info" onclick="importBranches()">
                  <i class="bi bi-upload me-1"></i> Import Branches
                </button>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Branch Name</th>
                  <th>Manager</th>
                  <th>Contact</th>
                  <th>Address</th>
                  <th>Cases Count</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="branchTableBody">
                <!-- Branch data will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== ADD BRANCH MODAL ===== -->
  <div class="modal fade" id="addBranchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Branch</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addBranchForm">
            <div class="mb-3">
              <label for="newBranchName" class="form-label">Branch Name *</label>
              <input type="text" class="form-control" id="newBranchName" required>
            </div>
            <div class="mb-3">
              <label for="newBranchManager" class="form-label">Manager Name *</label>
              <input type="text" class="form-control" id="newBranchManager" required>
            </div>
            <div class="mb-3">
              <label for="newBranchContact" class="form-label">Contact Number *</label>
              <input type="tel" class="form-control" id="newBranchContact" required>
            </div>
            <div class="mb-3">
              <label for="newBranchEmail" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="newBranchEmail">
            </div>
            <div class="mb-3">
              <label for="newBranchAddress" class="form-label">Address *</label>
              <textarea class="form-control" id="newBranchAddress" rows="3" required></textarea>
            </div>
            <div class="mb-3">
              <label for="newBranchNotes" class="form-label">Additional Notes</label>
              <textarea class="form-control" id="newBranchNotes" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveNewBranch()">Save Branch</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== DAILY SUMMARY MODAL ===== -->
  <div class="modal fade" id="dailySummaryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Daily Branch Summary</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body daily-summary-modal">
          <div class="mb-3">
            <div class="row">
              <div class="col-md-6">
                <input type="date" class="form-control" id="summaryDateInput">
              </div>
              <div class="col-md-6">
                <button class="btn btn-primary" onclick="generateDailySummary()">
                  <i class="bi bi-calendar-check me-1"></i> Generate Summary
                </button>
              </div>
            </div>
          </div>
          
          <div id="dailySummaryContent">
            <!-- Daily summary content will be populated here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="exportDailySummary()">
            <i class="bi bi-download me-1"></i> Export Summary
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== API SETTINGS MODAL ===== -->
  <div class="modal fade" id="apiSettingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">API Settings</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="apiUrl" class="form-label">API Endpoint URL</label>
            <input type="url" class="form-control" id="apiUrl" placeholder="https://example.com/api/tickets">
          </div>
          <div class="mb-3">
            <label for="apiKey" class="form-label">API Key (if required)</label>
            <input type="password" class="form-control" id="apiKey" placeholder="Your API key">
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="replaceData">
            <label class="form-check-label" for="replaceData">
              Replace existing data
            </label>
          </div>
          <div class="mb-3">
            <label for="apiFormat" class="form-label">Data Format</label>
            <select class="form-select" id="apiFormat">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="fetchDataFromAPIWithSettings()">Fetch Data</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ===== EXCEL UPLOAD INPUT (HIDDEN) ===== -->
  <input type="file" id="excelUploadInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileUpload(event)">
  
  <!-- ===== JAVASCRIPT ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <script>
    // ===== GLOBAL VARIABLES =====
    let tickets = [];
    let branches = [];
    let commands = [];
    let settings = {
      theme: 'light',
      itemsPerPage: 25,
      autoRefresh: 0,
      backupFrequency: 7,
      notifications: true,
      confirmActions: true
    };
    
    // Branch WhatsApp numbers
    const branchWhats = {
      "Crispy Chicken Khalidiya": "971569494764",
      "Crispy Chicken Muroor": "971505414641",
      "Crispy Chicken Shabiya 11": "971562690688",
      "Crispy Chicken Al Barsha": "971569659524",
      "Crispy Chicken Al Satwa": "971567970685",
      "Crispy Chicken Electra": "971563866859",
      "Crispy Chicken Hamdan": "971556886650",
      "Crispy Chicken-Al Khalidiya": "971569494764"
    };
    
    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      // Load data from localStorage
      loadData();
      
      // Initialize UI
      updateStats();
      updateSummarySection();
      updatePlatformCards();
      updateCharts();
      updateBranchAnalysis();
      updateCompensationAnalysis();
      updateRejectionAnalysis();
      updateRefundAnalysis();
      renderTicketsTable();
      updateBranchFilter();
      updateCommands();
      
      // Set current date for summary
      const today = new Date();
      document.getElementById('summaryDate').textContent = today.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      // Set today's date as default for summary date input
      document.getElementById('summaryDateInput').valueAsDate = today;
      
      // Setup event listeners
      setupEventListeners();
      
      // Show notification
      showNotification('Dashboard loaded successfully', 'success');
      
      // Add command
      addCommand('Dashboard initialized', 'System');
      
      // Initialize form
      initializeForm();
      
      // Update notification badge
      updateNotificationBadge();
    });
    
    // ===== DATA MANAGEMENT =====
    function loadData() {
      // Load tickets
      const ticketsData = localStorage.getItem('compensationTickets');
      if (ticketsData) {
        tickets = JSON.parse(ticketsData);
      } else {
        // Initialize with sample data if none exists
        tickets = [];
      }
      
      // Load branches
      const branchesData = localStorage.getItem('branches');
      if (branchesData) {
        branches = JSON.parse(branchesData);
      } else {
        // Initialize with default branches
        branches = [
          { id: 1, name: 'Crispy Chicken Khalidiya', manager: 'John Smith', contact: '+971569494764', address: '123 Khalidiya St, Abu Dhabi' },
          { id: 2, name: 'Crispy Chicken Muroor', manager: 'Sarah Johnson', contact: '+971505414641', address: '456 Muroor Rd, Abu Dhabi' },
          { id: 3, name: 'Crispy Chicken Shabiya 11', manager: 'Michael Brown', contact: '+971562690688', address: '789 Shabiya St, Abu Dhabi' },
          { id: 4, name: 'Crispy Chicken Al Barsha', manager: 'Emily Davis', contact: '+971569659524', address: '101 Al Barsha Ave, Dubai' },
          { id: 5, name: 'Crispy Chicken Al Satwa', manager: 'David Wilson', contact: '+971567970685', address: '202 Satwa Rd, Dubai' },
          { id: 6, name: 'Crispy Chicken Electra', manager: 'Jennifer Miller', contact: '+971563866859', address: '303 Electra St, Dubai' },
          { id: 7, name: 'Crispy Chicken Hamdan', manager: 'Robert Taylor', contact: '+971556886650', address: '404 Hamdan St, Abu Dhabi' },
          { id: 8, name: 'Crispy Chicken-Al Khalidiya', manager: 'Lisa Anderson', contact: '+971569494764', address: '505 Khalidiya Blvd, Abu Dhabi' }
        ];
        saveBranches();
      }
      
      // Load commands
      const commandsData = localStorage.getItem('commands');
      if (commandsData) {
        commands = JSON.parse(commandsData);
      } else {
        commands = [];
      }
      
      // Load settings
      const settingsData = localStorage.getItem('dashboardSettings');
      if (settingsData) {
        settings = JSON.parse(settingsData);
        applySettings();
      }
      
      // Load notifications
      const notificationsData = localStorage.getItem('managerNotifications');
      if (notificationsData) {
        // Just update the badge
        updateNotificationBadge();
      }
      
      // Update storage indicator
      updateStorageIndicator();
    }
    
    function saveData() {
      localStorage.setItem('compensationTickets', JSON.stringify(tickets));
      localStorage.setItem('branches', JSON.stringify(branches));
      localStorage.setItem('commands', JSON.stringify(commands));
      localStorage.setItem('dashboardSettings', JSON.stringify(settings));
      updateStorageIndicator();
    }
    
    function saveBranches() {
      localStorage.setItem('branches', JSON.stringify(branches));
    }
    
    function saveSettings() {
      localStorage.setItem('dashboardSettings', JSON.stringify(settings));
      applySettings();
      showNotification('Settings saved successfully', 'success');
      addCommand('Settings updated', 'User');
    }
    
    function applySettings() {
      // Apply theme
      if (settings.theme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (settings.theme === 'light') {
        document.body.classList.remove('dark-theme');
      }
      
      // Apply auto refresh
      if (settings.autoRefresh > 0) {
        if (window.refreshInterval) {
          clearInterval(window.refreshInterval);
        }
        window.refreshInterval = setInterval(refreshData, settings.autoRefresh * 60000);
      }
      
      // Apply backup frequency
      if (settings.backupFrequency > 0) {
        if (window.backupInterval) {
          clearInterval(window.backupInterval);
        }
        window.backupInterval = setInterval(backupData, settings.backupFrequency * 86400000);
      }
    }
    
    function updateStorageIndicator() {
      // Calculate storage usage
      let totalSize = 0;
      for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
          totalSize += localStorage[key].length + key.length;
        }
      }
      
      // Convert to KB
      const totalSizeKB = (totalSize / 1024).toFixed(2);
      const maxStorageKB = 5120; // 5MB
      const percentage = Math.min(100, Math.round((totalSizeKB / maxStorageKB) * 100));
      
      const indicator = document.getElementById('storageIndicator');
      indicator.textContent = `${percentage}% storage used (${totalSizeKB}KB)`;
      
      if (percentage > 80) {
        indicator.classList.add('storage-warning');
      } else {
        indicator.classList.remove('storage-warning');
      }
    }
    
    // ===== EVENT LISTENERS =====
    function setupEventListeners() {
      // Search input
      document.getElementById('searchInput').addEventListener('input', filterTickets);
      
      // Filter dropdowns
      document.getElementById('filterBranch').addEventListener('change', filterTickets);
      document.getElementById('filterPlatform').addEventListener('change', filterTickets);
      document.getElementById('filterStatus').addEventListener('change', filterTickets);
      
      // Order ID input for duplicate check
      document.getElementById('orderId').addEventListener('input', checkForDuplicateOrder);
      
      // Back to top button
      window.addEventListener('scroll', function() {
        const backToTopButton = document.getElementById('backToTop');
        if (window.pageYOffset > 300) {
          backToTopButton.classList.add('show');
        } else {
          backToTopButton.classList.remove('show');
        }
      });
      
      // Settings form
      document.getElementById('theme').addEventListener('change', function() {
        settings.theme = this.value;
      });
      
      document.getElementById('itemsPerPage').addEventListener('change', function() {
        settings.itemsPerPage = parseInt(this.value);
      });
      
      document.getElementById('autoRefresh').addEventListener('change', function() {
        settings.autoRefresh = parseInt(this.value);
      });
      
      document.getElementById('backupFrequency').addEventListener('change', function() {
        settings.backupFrequency = parseInt(this.value);
      });
      
      document.getElementById('notifications').addEventListener('change', function() {
        settings.notifications = this.checked;
      });
      
      document.getElementById('confirmActions').addEventListener('change', function() {
        settings.confirmActions = this.checked;
      });
      
      // Close notifications panel when clicking outside
      document.addEventListener('click', function(event) {
        const panel = document.getElementById('notificationsPanel');
        const bellIcon = document.querySelector('.nav-link[href="#"]');
        
        if (!panel.contains(event.target) && !bellIcon.contains(event.target)) {
          panel.classList.remove('show');
        }
      });
    }
    
    // ===== UI UPDATE FUNCTIONS =====
    function updateStats() {
      // Total tickets
      document.getElementById('totalTickets').textContent = tickets.length;
      
      // Status counts
      const openTickets = tickets.filter(t => t.status === 'Open').length;
      const sentTickets = tickets.filter(t => t.status === 'Sent').length;
      const closedTickets = tickets.filter(t => t.status === 'Closed').length;
      const rejectedTickets = tickets.filter(t => t.status === 'Rejected').length;
      
      document.getElementById('openTickets').textContent = openTickets;
      document.getElementById('sentTickets').textContent = sentTickets;
      document.getElementById('closedTickets').textContent = closedTickets;
      document.getElementById('rejectedTickets').textContent = rejectedTickets;
      
      // Resolved disputes (closed tickets with refunded amount)
      const resolvedDisputes = tickets.filter(t => t.status === 'Closed' && t.refundedAmount > 0).length;
      document.getElementById('resolvedDisputes').textContent = resolvedDisputes;
      
      // Active compensations (open or sent tickets)
      const activeCompensations = tickets.filter(t => t.status === 'Open' || t.status === 'Sent').length;
      document.getElementById('activeCompensations').textContent = activeCompensations;
      
      // Total compensation amount
      const totalCompensation = tickets.reduce((sum, t) => sum + parseFloat(t.compensationAmount || 0), 0);
      document.getElementById('totalCompensationAmount').textContent = totalCompensation.toFixed(2);
    }
    
    function updateSummarySection() {
      // Financial Overview
      const totalOriginalAmount = tickets.reduce((sum, t) => sum + parseFloat(t.originalAmount || 0), 0);
      const totalCompensation = tickets.reduce((sum, t) => sum + parseFloat(t.compensationAmount || 0), 0);
      const totalRefunded = tickets.reduce((sum, t) => sum + parseFloat(t.refundedAmount || 0), 0);
      const netCompensation = totalCompensation - totalRefunded;
      
      document.getElementById('totalOriginalAmount').textContent = totalOriginalAmount.toFixed(2);
      document.getElementById('totalCompensation').textContent = totalCompensation.toFixed(2);
      document.getElementById('totalRefunded').textContent = totalRefunded.toFixed(2);
      document.getElementById('netCompensation').textContent = netCompensation.toFixed(2);
      
      // Platform Performance
      const noonTickets = tickets.filter(t => t.platform === 'Noon');
      const careemTickets = tickets.filter(t => t.platform === 'Careem');
      const noonRefunded = noonTickets.filter(t => t.refundedAmount > 0).length;
      const careemRefunded = careemTickets.filter(t => t.refundedAmount > 0).length;
      
      document.getElementById('noonTickets').textContent = noonTickets.length;
      document.getElementById('careemTickets').textContent = careemTickets.length;
      document.getElementById('noonRefunded').textContent = noonRefunded;
      document.getElementById('careemRefunded').textContent = careemRefunded;
      
      // Branch Performance
      const branchCounts = {};
      tickets.forEach(t => {
        branchCounts[t.branch] = (branchCounts[t.branch] || 0) + 1;
      });
      
      const topBranch = Object.keys(branchCounts).reduce((a, b) => 
        branchCounts[a] > branchCounts[b] ? a : b, '-');
      
      document.getElementById('topBranch').textContent = topBranch;
      document.getElementById('topBranchCases').textContent = 
        topBranch !== '-' ? `${branchCounts[topBranch]} cases` : '0 cases';
      
      // Top case type
      const caseTypes = {};
      tickets.forEach(t => {
        // Extract case type from issue description (simplified)
        const caseType = t.issue.split(' ')[0] || 'Other';
        caseTypes[caseType] = (caseTypes[caseType] || 0) + 1;
      });
      
      const topCase = Object.keys(caseTypes).reduce((a, b) => 
        caseTypes[a] > caseTypes[b] ? a : b, '-');
      
      document.getElementById('topCase').textContent = topCase;
      document.getElementById('topCaseCount').textContent = 
        topCase !== '-' ? `${caseTypes[topCase]} cases` : '0 cases';
      
      // Case rate (cases per 100 orders - simplified calculation)
      const caseRate = tickets.length > 0 ? 
        ((tickets.length / (tickets.length * 10)) * 100).toFixed(1) : 0;
      document.getElementById('caseRate').textContent = `${caseRate}%`;
      
      // Average original amount
      const avgOriginalAmount = tickets.length > 0 ? 
        (totalOriginalAmount / tickets.length).toFixed(2) : 0;
      document.getElementById('avgOriginalAmount').textContent = avgOriginalAmount;
      
      // Update charts
      updateSummaryCharts();
    }
    
    function updateSummaryCharts() {
      // Amount Chart
      const amountCtx = document.getElementById('amountChart').getContext('2d');
      new Chart(amountCtx, {
        type: 'bar',
        data: {
          labels: ['Original', 'Compensation', 'Refunded', 'Net'],
          datasets: [{
            data: [
              tickets.reduce((sum, t) => sum + parseFloat(t.originalAmount || 0), 0),
              tickets.reduce((sum, t) => sum + parseFloat(t.compensationAmount || 0), 0),
              tickets.reduce((sum, t) => sum + parseFloat(t.refundedAmount || 0), 0),
              tickets.reduce((sum, t) => sum + (parseFloat(t.compensationAmount || 0) - parseFloat(t.refundedAmount || 0)), 0)
            ],
            backgroundColor: [
              'rgba(54, 162, 235, 0.5)',
              'rgba(255, 99, 132, 0.5)',
              'rgba(75, 192, 192, 0.5)',
              'rgba(153, 102, 255, 0.5)'
            ],
            borderColor: [
              'rgba(54, 162, 235, 1)',
              'rgba(255, 99, 132, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // Status Chart
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: ['Open', 'Sent', 'Closed', 'Rejected'],
          datasets: [{
            data: [
              tickets.filter(t => t.status === 'Open').length,
              tickets.filter(t => t.status === 'Sent').length,
              tickets.filter(t => t.status === 'Closed').length,
              tickets.filter(t => t.status === 'Rejected').length
            ],
            backgroundColor: [
              'rgba(13, 110, 253, 0.5)',
              'rgba(255, 193, 7, 0.5)',
              'rgba(25, 135, 84, 0.5)',
              'rgba(220, 53, 69, 0.5)'
            ],
            borderColor: [
              'rgba(13, 110, 253, 1)',
              'rgba(255, 193, 7, 1)',
              'rgba(25, 135, 84, 1)',
              'rgba(220, 53, 69, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
      
      // Platform Tickets Chart
      const platformTicketsCtx = document.getElementById('platformTicketsChart').getContext('2d');
      new Chart(platformTicketsCtx, {
        type: 'bar',
        data: {
          labels: ['Noon', 'Careem'],
          datasets: [{
            label: 'Cases',
            data: [
              tickets.filter(t => t.platform === 'Noon').length,
              tickets.filter(t => t.platform === 'Careem').length
            ],
            backgroundColor: [
              'rgba(255, 112, 67, 0.5)',
              'rgba(126, 87, 194,
